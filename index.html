<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“š Ù…Ø¬Ù„Ø© Ø§Ù„Ù‚Ø³Ù…</title>
    <!-- Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ù…Ø¨Ø§Ø´Ø± -->
    <base href="/">
    <style>
        /* Ù†ÙØ³ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚ */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .header { background: white; padding: 1rem 2rem; border-radius: 15px; margin-bottom: 2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header-top { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem; }
        .logo h1 { color: #667eea; font-size: 1.8rem; display: flex; align-items: center; gap: 10px; }
        .logo p { color: #666; font-size: 0.9rem; }
        .admin-btn { background: #333; color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 50px; font-size: 1rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; transition: transform 0.3s; }
        .admin-btn:hover { transform: scale(1.05); background: #444; }
        .search-section { background: #f0f2f5; padding: 1rem; border-radius: 15px; margin-top: 1rem; }
        .search-box { position: relative; width: 100%; }
        .search-box input { width: 100%; padding: 1rem 1rem 1rem 3.5rem; border: 2px solid #e0e0e0; border-radius: 50px; font-size: 1rem; transition: all 0.3s; background: white; }
        .search-box input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.1); }
        .search-icon { position: absolute; right: 1.2rem; top: 50%; transform: translateY(-50%); color: #667eea; font-size: 1.2rem; }
        .clear-search { position: absolute; left: 1.2rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: #999; font-size: 1.2rem; cursor: pointer; display: none; }
        .clear-search:hover { color: #dc3545; }
        .search-stats { margin-top: 0.5rem; color: #666; font-size: 0.9rem; display: flex; justify-content: space-between; align-items: center; }
        .result-count { background: #667eea; color: white; padding: 0.2rem 1rem; border-radius: 50px; font-size: 0.8rem; }
        .posts-container { display: flex; flex-direction: column; gap: 2rem; margin-top: 2rem; }
        .post-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .post-header { padding: 1.5rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; display: flex; justify-content: space-between; align-items: center; }
        .post-type { background: rgba(255,255,255,0.2); padding: 0.3rem 1rem; border-radius: 50px; font-size: 0.9rem; }
        .post-date { font-size: 0.9rem; opacity: 0.9; }
        .post-content { padding: 2rem; }
        .post-title { font-size: 1.8rem; margin-bottom: 1rem; color: #333; }
        .post-text { color: #555; line-height: 1.8; font-size: 1.1rem; margin-bottom: 1.5rem; }
        .footer { background: white; text-align: center; padding: 2rem; margin-top: 3rem; border-radius: 15px; color: #666; }
        .loading { text-align: center; padding: 2rem; color: white; font-size: 1.2rem; }
        .no-posts { text-align: center; padding: 4rem; background: white; border-radius: 15px; color: #666; font-size: 1.2rem; }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #28a745; color: white; padding: 1rem 2rem; border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 3000; animation: slideUp 0.3s; display: none; }
        @keyframes slideUp { from { opacity: 0; transform: translate(-50%, 20px); } to { opacity: 1; transform: translate(-50%, 0); } }
        .toast.show { display: block; }
        .toast.error { background: #dc3545; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-top">
            <div class="logo">
                <h1>ğŸ“š Ù…Ø¬Ù„Ø© Ø§Ù„Ù‚Ø³Ù…</h1>
                <p>Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ… ÙˆØ§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ©</p>
            </div>
            <button class="admin-btn" onclick="showAdminLogin()">
                <span>âš™ï¸</span> Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
            </button>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø¨Ø­Ø« -->
        <div class="search-section">
            <div class="search-box">
                <span class="search-icon">ğŸ”</span>
                <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ…..." oninput="handleSearch()">
                <button class="clear-search" id="clearSearchBtn" onclick="clearSearch()">âœ•</button>
            </div>
            <div class="search-stats">
                <span id="searchResultText">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ…</span>
                <span id="searchCount" class="result-count">0</span>
            </div>
        </div>
    </header>

    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="adminLoginScreen" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:2000;">
        <div style="background:white; padding:2rem; border-radius:15px; width:90%; max-width:400px; text-align:center;">
            <h2>ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†</h2>
            <input type="password" id="adminPassword" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø²" style="width:100%; padding:1rem; margin:1rem 0; border:2px solid #e0e0e0; border-radius:8px;">
            <div>
                <button onclick="checkAdminPassword()" style="background:#667eea; color:white; border:none; padding:0.8rem 1.5rem; border-radius:8px; cursor:pointer; margin:0.5rem;">Ø¯Ø®ÙˆÙ„</button>
                <button onclick="hideAdminLogin()" style="background:#dc3545; color:white; border:none; padding:0.8rem 1.5rem; border-radius:8px; cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
            <div id="loginError" style="color:#dc3545; margin-top:1rem; display:none;">Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­</div>
        </div>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
    <div id="adminPanel" style="background:white; padding:2rem; border-radius:15px; margin-bottom:2rem; display:none; box-shadow:0 4px 15px rgba(0,0,0,0.1);">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
            <h3 style="color:#667eea;">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
            <button onclick="logout()" style="background:#dc3545; color:white; border:none; padding:0.5rem 1rem; border-radius:5px; cursor:pointer;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
        <div class="add-post-form" style="background:#f9f9f9; padding:1.5rem; border-radius:10px;">
            <h4 style="margin-bottom:1rem;">Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù…ÙŠÙ… Ø¬Ø¯ÙŠØ¯</h4>
            <div style="margin-bottom:1rem;">
                <label style="display:block; margin-bottom:0.5rem; color:#333; font-weight:600;">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</label>
                <select id="postType" style="width:100%; padding:1rem; border:2px solid #e0e0e0; border-radius:8px;">
                    <option value="ØªØ¹Ù…ÙŠÙ…">ğŸ“¢ ØªØ¹Ù…ÙŠÙ…</option>
                    <option value="Ù…Ù‚Ø§Ù„">ğŸ“ Ù…Ù‚Ø§Ù„</option>
                    <option value="Ø¥Ø¹Ù„Ø§Ù†">ğŸ“Œ Ø¥Ø¹Ù„Ø§Ù†</option>
                    <option value="Ø®Ø¨Ø±">ğŸ“° Ø®Ø¨Ø±</option>
                </select>
            </div>
            <div style="margin-bottom:1rem;">
                <label style="display:block; margin-bottom:0.5rem; color:#333; font-weight:600;">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†Ø´ÙˆØ±</label>
                <input type="text" id="postTitle" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†Ø´ÙˆØ±" style="width:100%; padding:1rem; border:2px solid #e0e0e0; border-radius:8px;">
            </div>
            <div style="margin-bottom:1rem;">
                <label style="display:block; margin-bottom:0.5rem; color:#333; font-weight:600;">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</label>
                <textarea id="postText" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ±" style="width:100%; padding:1rem; border:2px solid #e0e0e0; border-radius:8px; height:120px;"></textarea>
            </div>
            <button onclick="addPost()" style="background:#28a745; color:white; border:none; padding:1rem; border-radius:8px; font-size:1.1rem; cursor:pointer; width:100%; margin-top:1rem;">ğŸ“¢ Ù†Ø´Ø± Ø§Ù„ØªØ¹Ù…ÙŠÙ…</button>
        </div>
    </div>

    <main class="container">
        <div id="postsContainer" class="posts-container">
            <div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¹Ø§Ù…ÙŠÙ…...</div>
        </div>
    </main>

    <footer class="footer">
        <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© 2024 - Ù…Ø¬Ù„Ø© Ø§Ù„Ù‚Ø³Ù…</p>
    </footer>

    <div id="toast" class="toast"></div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbykDvt8HEjz0Y_WzIzpZyYWzZjU_Y7EtUdUu6QEqxtn1wI6iwu_5qhgFCedjHLF2ahNpg/exec';
        const ADMIN_PASSWORD = "admin";
        let isAdminLoggedIn = false;
        let allPosts = [];

        function showAdminLogin() {
            document.getElementById('adminLoginScreen').style.display = 'flex';
        }

        function hideAdminLogin() {
            document.getElementById('adminLoginScreen').style.display = 'none';
        }

        function checkAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                isAdminLoggedIn = true;
                document.getElementById('adminPanel').style.display = 'block';
                hideAdminLogin();
                loadPosts();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        }

        function logout() {
            isAdminLoggedIn = false;
            document.getElementById('adminPanel').style.display = 'none';
            loadPosts();
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = isError ? '#dc3545' : '#28a745';
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 3000);
        }

        async function loadPosts() {
            const container = document.getElementById('postsContainer');
            try {
                const response = await fetch(`${SCRIPT_URL}?action=get`);
                const data = await response.json();
                if (data.success) {
                    allPosts = data.posts;
                    document.getElementById('searchCount').textContent = allPosts.length;
                    filterPosts(document.getElementById('searchInput').value);
                } else {
                    container.innerHTML = '<div class="no-posts">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';
                }
            } catch (error) {
                container.innerHTML = '<div class="no-posts">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>';
            }
        }

        function filterPosts(searchTerm) {
            const container = document.getElementById('postsContainer');
            if (!allPosts.length) {
                container.innerHTML = '<div class="no-posts">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ø§Ù…ÙŠÙ… Ø¨Ø¹Ø¯</div>';
                return;
            }

            let filteredPosts = allPosts;
            if (searchTerm) {
                filteredPosts = allPosts.filter(post => 
                    post.title.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }

            if (filteredPosts.length === 0) {
                container.innerHTML = `<div class="no-posts">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù€ "${searchTerm}"</div>`;
                return;
            }

            const sortedPosts = filteredPosts.sort((a, b) => new Date(b.date) - new Date(a.date));
            let html = '';
            sortedPosts.forEach(post => {
                const date = new Date(post.date).toLocaleString('ar-EG', {
                    year: 'numeric', month: 'long', day: 'numeric',
                    hour: '2-digit', minute: '2-digit'
                });
                html += `
                    <div class="post-card">
                        <div class="post-header">
                            <span class="post-type">${post.type}</span>
                            <span class="post-date">${date}</span>
                        </div>
                        <div class="post-content">
                            <h2 class="post-title">${post.title}</h2>
                            <div class="post-text">${post.text.replace(/\n/g, '<br>')}</div>
                            ${isAdminLoggedIn ? `
                                <button class="delete-post-btn" onclick="deletePost(${post.id})" style="background:#dc3545; color:white; border:none; padding:0.5rem 1rem; border-radius:5px; cursor:pointer; margin-top:1rem;">
                                    ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ØªØ¹Ù…ÙŠÙ…
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function handleSearch() {
            const searchTerm = document.getElementById('searchInput').value;
            document.getElementById('clearSearchBtn').style.display = searchTerm ? 'block' : 'none';
            filterPosts(searchTerm);
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('clearSearchBtn').style.display = 'none';
            filterPosts('');
        }

        async function addPost() {
            if (!isAdminLoggedIn) { showToast('âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', true); return; }
            const type = document.getElementById('postType').value;
            const title = document.getElementById('postTitle').value;
            const text = document.getElementById('postText').value;
            if (!title || !text) { showToast('âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰', true); return; }
            
            try {
                const url = `${SCRIPT_URL}?action=add&type=${encodeURIComponent(type)}&title=${encodeURIComponent(title)}&text=${encodeURIComponent(text)}`;
                const response = await fetch(url);
                const data = await response.json();
                if (data.success) {
                    showToast('âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­');
                    document.getElementById('postTitle').value = '';
                    document.getElementById('postText').value = '';
                    await loadPosts();
                }
            } catch (error) {
                showToast('âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø´Ø±', true);
            }
        }

        async function deletePost(id) {
            if (!isAdminLoggedIn) { showToast('âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', true); return; }
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) return;
            
            try {
                const response = await fetch(`${SCRIPT_URL}?action=delete&id=${id}`);
                const data = await response.json();
                if (data.success) {
                    showToast('âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­');
                    await loadPosts();
                }
            } catch (error) {
                showToast('âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù', true);
            }
        }

        loadPosts();
        setInterval(loadPosts, 30000);
    </script>
</body>
</html>
